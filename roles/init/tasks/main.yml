---
- name: init Install
  sudo: yes
  yum: name={{item}} state=present
  with_items: yum_list

- name: init Set TimeZone
  sudo: yes
  file: src={{ timezone }} dest=/etc/localtime state=link force=yes mode='u=rw,go=r'
  notify: restart crond

- name: init Set logrotate format
  sudo: yes
  lineinfile: >-
    dest=/etc/logrotate.conf
    regexp='^#?dateext|^#?nodateext'
    line='nodateext'

- name: init Set cloud.cfg
  sudo: yes
  lineinfile: >-
    dest=/etc/cloud/cloud.cfg
    regexp='^repo_upgrade.*'
    line='repo_upgrade: none'
  when: ansible_distribution == 'Amazon'

- name: init CommentOut net.bridge.bridge-nf-call-*
  sudo: yes
  replace: dest=/etc/sysctl.conf regexp='^net.bridge.bridge-nf-call-' replace='#net.bridge.bridge-nf-call-'

- name: init Set Sysctl
  sudo: yes
  sysctl: name='{{item.key}}' value='{{item.value}}' state=present reload=yes
  with_dict: sysctl

- name: init Set visudo template
  sudo: yes
  template: src=vm-init dest=/etc/sudoers.d/vm-init mode='ug=r,o='
